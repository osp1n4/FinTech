# Redis Configuration
# Fraud Detection System - Cache Layer

# Network
bind 0.0.0.0
protected-mode no
port 6379

# General
daemonize no
pidfile /var/run/redis_6379.pid
loglevel notice
logfile ""

# Snapshotting (Persistence)
# Save after 900 sec if at least 1 key changed
save 900 1
# Save after 300 sec if at least 10 keys changed
save 300 10
# Save after 60 sec if at least 10000 keys changed
save 60 10000

stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir /data

# Replication (for HA setup)
# replica-read-only yes
# min-replicas-to-write 1
# min-replicas-max-lag 10

# Security
# requirepass fraud2026_change_in_production

# Limits
maxclients 10000
maxmemory 256mb
# Evict least recently used keys
maxmemory-policy allkeys-lru

# Append Only File (AOF) - Better durability
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# Slow log
# microseconds (10ms)
slowlog-log-slower-than 10000
slowlog-max-len 128

# Latency monitoring
# milliseconds
latency-monitor-threshold 100

# Event notification (for cache invalidation)
# Expiration events
notify-keyspace-events "Ex"

# Fraud Detection Specific Settings
# Key naming convention:
# - location:{user_id} → User location cache
# - config:thresholds → Fraud thresholds configuration
# - session:{user_id} → User session data
# - device:{device_id} → Device validation cache

# TTL defaults (managed by application)
# - User locations: 86400 seconds (24 hours)
# - Config cache: No expiration (manual invalidation)
# - Sessions: 3600 seconds (1 hour)
# - Device cache: 604800 seconds (7 days)
